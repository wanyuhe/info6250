(()=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n(e)}function e(e,t,r){return o=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==n(o)?o:String(o))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e;var o}var t="noSession",r=e(e(e(e({},"networkError","Trouble connecting to the network.  Please try again"),"auth-insufficient","Your username/password combination does not match any records, please try again."),"required-username","Please enter a valid (letters and/or numbers) username"),"default","Something went wrong.  Please try again"),o={isLoggedIn:!1,isLoginPending:!1,isMessagePending:!1,messages:[],sessions:{},username:"",error:""};function s(){o.isLoggedIn=!1,o.isLoginPending=!0,o.username="",o.messages={},o.error=""}function i(n){o.isLoggedIn=!0,o.isLoginPending=!1,o.username=n,o.messages={},o.error=""}function a(){o.isLoggedIn=!1,o.isLoginPending=!1,o.username="",o.messages={},o.error=""}function c(){o.Messages={},o.isMessagePending=!0,o.error=""}function u(n){o.messages=n.chatMessages,o.sessions=n.users,o.isMessagePending=!1,o.error=""}function l(n){o.messages.push(n),o.error=""}function f(n){n?(o.isLoginPending=!1,o.error=r[n]||r.default):o.error=""}const p=o;function m(){return fetch("/api/messages").catch((function(){return Promise.reject({error:"networkError"})})).then((function(n){return n.ok?n.json():n.json().catch((function(n){return Promise.reject({error:n})})).then((function(n){return Promise.reject(n)}))}))}function g(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}const d=function(n){var e=n.state,t=n.appEl,r='\n   <main class="">\n     '.concat(function(n){return'\n      <div class="status">'.concat(n.error,"</div>\n  ")}(e),"\n     ").concat(function(n){return n.isLoginPending?'\n      <div class="login__waiting">Logging in...</div>\n    ':n.isLoggedIn?"":'\n      <div class="login">\n        <form class="login__form">\n          <label>\n            <span>Username:</span>\n            <input class="login__username" type="text" value="">\n          </label>\n          <button class="login__button" type="submit">Login</button>\n        </form>\n      </div>\n  '}(e),"\n     ").concat(function(n){return n.isLoggedIn?n.isMessagePending?'\n            <div class="content">\n                '.concat('\n        <div class="controls">\n            <button class="controls__refresh">Refresh</button>\n            <button class="controls__logout">Logout</button>\n        </div>\n    ','\n                <div class="messages__waiting">Loading messages...</div>\n            </div>\n        '):'\n        <div class="content">\n            '.concat('\n        <div class="controls">\n            <button class="controls__refresh">Refresh</button>\n            <button class="controls__logout">Logout</button>\n        </div>\n    ','\n            <div class="messages-container">\n            <ul class="messages">').concat(function(n){return Object.values(n.messages).map((function(n){return'\n      <li class="message">\n        <span class="message__author">'.concat(n.username,':</span>\n        <span class="message__text">').concat(n.text,"</span>\n      </li>\n    ")})).join("")||"<p>No messages yetï¼Œ start the conversation!</p>"}(n),"</ul>\n            </div>\n            ").concat('\n        <form class="send__form">\n          <input class="send__input" type="text">\n          <button type="submit" class="send__button">Send</button>\n        </form>\n  ',"\n            ").concat(function(n){var e,t=Object.values(n.sessions).map((function(n){return n.username})),r=(e=new Set(t),function(n){if(Array.isArray(n))return g(n)}(e)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(e)||function(n,e){if(n){if("string"==typeof n)return g(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?g(n,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(n){return'\n            <li class="user">'.concat(n,"</li>\n        ")})).join("")||"<p>No other users online.</p>";return'\n        <div class="users">\n            <h3>Online Users</h3>\n            <ul class="users__list">\n                '.concat(r,"\n            </ul>\n        </div>\n    ")}(n),"\n        </div>\n    "):""}(e),"\n   </main>\n  ");t.innerHTML=r};var v=document.querySelector("#app");!function(n){var e=n.state,t=n.appEl;t.addEventListener("submit",(function(n){if(n.target.classList.contains("login__form")){n.preventDefault();var r=t.querySelector(".login__username").value;s(),d({state:e,appEl:t}),function(n){return fetch("/api/session",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({username:n})}).catch((function(){return Promise.reject({error:"networkError"})})).then((function(n){return n.ok?n.json():n.json().catch((function(n){return Promise.reject({error:n})})).then((function(n){return Promise.reject(n)}))}))}(r).then((function(n){return i(n.username),m()})).then((function(n){u(n),d({state:e,appEl:t})})).catch((function(n){f((null==n?void 0:n.error)||"ERROR"),d({state:e,appEl:t})}))}}))}({state:p,appEl:v}),function(n){var e=n.state,t=n.appEl;t.addEventListener("click",(function(n){n.target.classList.contains("controls__logout")&&(a(),d({state:e,appEl:t}),fetch("/api/session",{method:"DELETE"}).catch((function(){return Promise.reject({error:"networkError"})})).then((function(n){return n.ok?n.json():n.json().catch((function(n){return Promise.reject({error:n})})).then((function(n){return Promise.reject(n)}))})).catch((function(n){f((null==n?void 0:n.error)||"ERROR"),d({state:e,appEl:t})})))}))}({state:p,appEl:v}),function(n){var e=n.state,t=n.appEl;t.addEventListener("submit",(function(n){if(n.target.classList.contains("send__form")){n.preventDefault();var r,o=t.querySelector(".send__input");(r={text:o.value},fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch((function(){return Promise.reject({error:"networkError"})})).then((function(n){return n.ok?n.json():n.json().catch((function(n){return Promise.reject({error:n})})).then((function(n){return Promise.reject(n)}))}))).then((function(n){l(n),o.value="",d({state:e,appEl:t})})).catch((function(n){f((null==n?void 0:n.error)||"ERROR"),d({state:e,appEl:t})}))}}))}({state:p,appEl:v}),function(n){var e=n.state,t=n.appEl;t.addEventListener("click",(function(n){n.target.classList.contains("controls__refresh")&&(c(),d({state:e,appEl:t}),m().then((function(n){u(n),d({state:e,appEl:t})})).catch((function(n){f((null==n?void 0:n.error)||"ERROR"),d({state:e,appEl:t})})))}))}({state:p,appEl:v}),fetch("/api/session",{method:"GET"}).catch((function(){return Promise.reject({error:"networkError"})})).then((function(n){return n.ok?n.json():n.json().catch((function(n){return Promise.reject({error:n})})).then((function(n){return Promise.reject(n)}))})).then((function(n){return i(n.username),d({state:p,appEl:v}),m()})).catch((function(n){return"auth-missing"===(null==n?void 0:n.error)?Promise.reject({error:t}):Promise.reject(n)})).then((function(n){u(n),d({state:p,appEl:v})})).catch((function(n){if((null==n?void 0:n.error)==t)return a(),void d({state:p,appEl:v});f((null==n?void 0:n.error)||"ERROR"),d({state:p,appEl:v})})),setInterval((function(){return function(n){var e=n.state,t=n.appEl;!1!==e.isLoggedIn&&(c(),m().then((function(n){u(n),d({state:e,appEl:t})})).catch((function(n){f((null==n?void 0:n.error)||"ERROR"),d({state:e,appEl:t})})))}({state:p,appEl:v})}),5e3)})();
//# sourceMappingURL=bundle.js.map